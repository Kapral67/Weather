@page "/logout"

@using System.Net.Http
@using System.Net.Http.Json
@using System.Net.Http.Headers
@using System.Threading.Tasks
@using System.Linq
@using System.Text.Json

@inject HttpClient Http
@inject Microsoft.Extensions.Configuration.IConfiguration config
@inject IJSRuntime JSRuntime
@inject NavigationManager NavMan

@code{

    protected override async Task OnInitializedAsync(){
        await EndSession();
    }
    private async Task EndSession(){
        string cookie = await JSRuntime.InvokeAsync<string>("blazorExtensions.AuthGet", "Authorization");
        try{
            string token = cookie.Substring(cookie.IndexOf(" ") + 1);
            var logoutRequest = new HttpRequestMessage(HttpMethod.Post, config["API_URL"] + "logout");
            logoutRequest.Headers.Authorization = new AuthenticationHeaderValue("Token", token);
            await Http.SendAsync(logoutRequest);
        }catch(Exception){ }
        await JSRuntime.InvokeAsync<string>("blazorExtensions.AuthDelete", "Authorization");
        NavMan.NavigateTo("/");
    }
}
